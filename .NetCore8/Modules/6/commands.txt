###################
# SECURING INPUT OUTPUT
# ASVS 5 : VALIDATION SANITIZATION ENCODING
# 5.1 INPUT VALIDATION
# 5.2 SANITIZATION/SANDBOXING
# 5.3 OUTPUT ENCODING / INJECTION PREVENTION
# 5.5 DESERIALIZATION PROTECTION
###################

######## INPUT VALIDATION 5.1.4 ASVS (DATA TYPE BINDING + 5.1.3 REGEX VALIDATION)
# UserController.cs, line 30, gets Guid type as parameter that's ok, try changing as string
# Show that this exposes the call to alter the URL adding some <br> at the end, it gets an exception for line 33 because # # of null, we can't use invalid data to proceed in the code

# Areas > Identity > Pages > Account > Register.cshtml.cs Line 73, property First Name
# https://learn.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-8.0#html-encoding-using-razor
# First Name field in Register form is vulnerable to XSS, register and put Timo<script>alert("XSS here!");</script> in First Name, the HTML gets honored in following pages. Add length limit and regex by decommenting
  [Display(Name = "First name")]
  //[StringLength(20, ErrorMessage = "The {0} must be at least {2} and at max {1} characters long.", MinimumLength = 2)]
  //[RegularExpression(@"^[a-zA-Z'\-\s]{1,20}$", ErrorMessage = "Invalid Characters.")]
  public string FirstName { get; set; }

# At line 135 of Register.cshtml.cs, need to propagate first name
 if (_userManager.Options.SignIn.RequireConfirmedAccount)
                    {
                        return RedirectToPage("RegisterConfirmation", new { email = Input.Email,firstName = Input.FirstName, returnUrl = returnUrl });
                    }


# Register.cshtml add the corresponding First Name field
  <div class="form-floating">
      <input asp-for="Input.FirstName" class="form-control" autocomplete="First-name" aria-required="true" />
      <label asp-for="Input.FirstName"></label>
      <span asp-validation-for="Input.FirstName" class="text-danger"></span>
  </div>
# RegisterConfirmation.cshtml add the confirmation message
else
    {
<p>
        We're really happy to have you  @Model.FirstName. <br>
        Please check your email to confirm your account
</p>
    }
# Replace entire RegisterConfirmation.cshtml.cs from (6/end)





<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE example [<!ELEMENT example ANY><!ENTITY file SYSTEM "file:///c:/ps/appsettings.json">]><example>&file;</example>
